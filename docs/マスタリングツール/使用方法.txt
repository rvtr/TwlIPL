* ---------------------------------------------------
*
* TWL マスタリングツール 使用方法
*
* ---------------------------------------------------

(1) マスタリングツールとは
  PC用ツール。
  TWLのROMバイナリに含まれる開発機用の暗号データを量産機用データに置き換える。

(2) 使用に必要な機材

・マスタリングツール実行バイナリ(mastering.TWL.exe)
・Windows XP搭載PC
・cygwin
・実行用USBキー(通称 USBドングル)

(3) 使用方法
  コマンドラインから以下の引数をつけて実行してください。
  % mastering.TWL.exe [オプション] input_file output_file

  ○引数
    input_file  : 開発機用ROMファイル(srl)名
    output_file : 量産機用ROMファイル(srl)名

    (注意)
    ・input_file と output_file に同じ名前を指定することはできません。エラーとなります。
    ・output_file と同じ名前のファイルが存在すると、上書き確認メッセージが出力されます。
      このとき'y'を入力すると出力データが上書きされます。
      一方、'n'を入力するとマスタリングをせずに終了します。

  ○実行結果
  成功すると、"mastering succeeded" の文字が表示されてプログラムが終了します。
  失敗すると、エラーが発生した箇所と要因およびエラーコードが表示されてプログラムが終了します。
  失敗したときには output_file は自動的に削除されます。
  output_file に既存のファイル名を指定したときには、失敗時に削除されますのでご注意ください。

  ○特殊な入力に対する処理
  ゲームコードが"NTRJ"であるプログラム(検査用プログラムなど)は、
  以下の点で、通常のゲームソフトとはマスタリング処理が異なります。
  ・KeyTable2の算出が不可能であるとみなされ、エラー終了となる。
    後述の -t オプションで強制的に算出可能。
  ・KeyTable1領域にデータが強制的にライトされる。

  ○通常オプション
    -h : 使用方法を表示して終了します。
    -v : 処理の経過などの詳細なメッセージを表示します。
    -r : 逆マスタリング(逆変換)モード。
         マスタリング後のROMファイルをマスタリング前のROMファイルに戻します。
    -f : 上書き確認をせずに output_file にマスタリング後のROMデータをライトします。

  ○特殊オプション
    -s : SDカードブートアプリ専用の秘密鍵で署名をつけます。
         input_file がセキュアアプリであるときのみ指定可能です。
    -t : input_file のゲームコードが"NTRJ"であるときにも、
         エラー終了せずに、強制的に KeyTable2 を算出してライトします。
    -p : ROMヘッダ内の開発用暗号が旧バージョンで、かつROMファイルがクローンブート対応ソフトのとき、
         マスタリングによって署名に矛盾が生じるため、本来では、エラー終了しますが、
         このオプションによって、上記のエラー判定なしにマスタリングが実行されます。
    -g NEW_GAME_CODE :
         input_file のゲームコードが"NTRJ"のときのみ、
         ROMヘッダ内のゲームコード(およびTITLE ID)を
         NEW_GAME_CODE で指定した任意の4文字の文字列に置き換え、
         ゲームコードがその文字列であるとみなして、マスタリング処理を実行します。

以上
